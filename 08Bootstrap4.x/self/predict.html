<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predict</title>
    <link rel="stylesheet" href="../css/bootstrap.css">
    <style>
        .c{
            background-color: aquamarine;
        }
    </style>
</head>
<body>

    <div class="container bg-light">
        <!-- 导航栏 -->
        <nav class="navbar navbar-expand-sm navbar-dark bg-info fix-top">
            <a href="#" class="navbar-brand">Logo</a>
            <!-- navbar-toggler 更改按钮样式 data-toggle="collapse" data-target="#navbar" 绑定数据 -->
            <button class="navbar-toggler" data-toggle="collapse" data-target="#navbar3">
                <span class="navbar-toggler-icon"></span>   <!-- navbar-toggler-icon 在小于sm时,点击这个按钮就出现列表 -->
            </button>

            <div id="navbar3" class="collapse navbar-collapse">  <!-- collapse navbar-collapse 和 navbar-expand-sm 让宽度小于sm时,文字就消失 -->
                <div class="navbar-nav">
                    <a class="nav-item nav-link active" href="">首页</a>
                    <a class="nav-item nav-link" href="">列表</a>
                    <a class="nav-item nav-link" href="">图文</a>
                    <a class="nav-item nav-link" href="">关于</a>
                </div>
                <form action="#" class="form-inline ml-auto">
                    <input type="text" class="form-control mr-2" placeholder="搜索">
                    <button class="btn btn-danger my-2">Search</button>
                </form>
            </div>
        </nav>

        <div class="jumbotron mt-1">
            <h1 class="display-4">垃圾图像检测</h1>
            <h4 class="text-muted">请上传垃圾图片</h4>
            <hr>
            <form action="" class="form-row was-validated">
                <div class="form-group col-sm-6 mx-auto">
                    <label for="file">上传文件:</label>
                    <div class="custom-file">
                        <input id="picker" type="file" class="custom-file-input" id="file" required>
                        <label for="file" class="custom-file-label" id="file-label">选择文件</label>
                    </div>
                </div>
            </form>
            <p class="lead d-flex justify-content-center">
                <button id="predict" class="btn btn-success btn-lg">点击检测</button>
            </p>
        </div>
        <hr>

        <div id="spinner" class="text-center mb-3">
            <div class="spinner-border text-success"></div>
        </div>
        <div class="card w-75 bg-info text-light border-info mx-auto">
            <div class="row">
                <div class="col-md-6">
                    <img class="card-img img-thumbnail" src="img/bt.png" alt="bt">
                </div>
                <div class="col-md-6">
                    <div class="card-body">
                        <p class="card-text">这里是卡片的文本内容...</p>
                    </div>
                </div>
            </div>
        </div>
        <hr><br>

    </div>
</body>
<script src="../js/jquery-3.6.0.js"></script>
<script src="../js/bootstrap.bundle.js"></script>
<script src="./webuploader/webuploader.js"></script>
<script>
    $('#spinner').stop().hide()
    $('#file').change(function(e) {
        $('#file-label').html(e.target.files[0].name);
    });
    $('#predict').click(function(){
        //滑动出现
        $('#spinner').stop().slideToggle()
    })


    //初始化Web Uploader
    var uploader = WebUploader.create({

        //选完文件后，是否自动上传。
        auto: false,

        //swf文件路径
        swf: "./webuploader/Uploader/swf",

        //文件接收服务端。
        server: "???",

        //文件上传时携带的参数
        formData: {
        },

        //选择文件的按钮。可选。
        //内部根据当前运行是创建，可能是input元素，也可能是flash.
        pick: {
            id: '#picker',
            //是否开启选择多个文件的能力
            multiple: false,
        },

        //文件上传在表单中的名字
        fileVal: 'image',

        // 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！
        resize: false
    });


    // 当有文件添加进来的时候
    uploader.on( 'fileQueued', function( file ) {
        console.log(file);
    });


    //手动上传图片
    $('#upload').click(function(){
        var dd = uploader.getFiles().length;
        var formData = {};
        if (dd > 0) {
            uploader.options.formData = formData;
            uploader.upload();
        } else {
            alert("请选择文件");
        }
    })

    //上传成功后的异步方法 上传一张照片就调用一次     可能性  类别
    uploader.on('uploadSuccess', function (file, {y_prob, y_predict, img_url}) {
        console.log(y_prob);
        console.log(y_predict);
        $('#y_predict').html(y_predict)
        $('#y_prob').html(y_prob)
        console.log(img_url); ///static/pic/upload/24-0030.jpg
        $('img').attr('src', img_url)
    });
</script>
</html>